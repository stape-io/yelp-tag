___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Yelp Conversion API",
  "brand": {
    "id": "brand_dummy",
    "displayName": "Custom Template",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Tag that send the event data from the GA4/Data client to Yelp Conversion API.",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "RADIO",
    "name": "eventType",
    "displayName": "Event Name Setup Method",
    "radioItems": [
      {
        "value": "standard",
        "displayValue": "Standard",
        "subParams": [
          {
            "type": "SELECT",
            "name": "eventNameStandard",
            "selectItems": [
              {
                "value": "purchase",
                "displayValue": "Purchase"
              },
              {
                "value": "page_view",
                "displayValue": "Page View"
              },
              {
                "value": "add_payment_info",
                "displayValue": "Add Payment Info"
              },
              {
                "value": "add_to_cart",
                "displayValue": "Add To Cart"
              },
              {
                "value": "add_to_wishlist",
                "displayValue": "Add To Wishlist"
              },
              {
                "value": "search",
                "displayValue": "Search"
              },
              {
                "value": "checkout",
                "displayValue": "Checkout"
              },
              {
                "value": "lead",
                "displayValue": "Lead"
              },
              {
                "value": "view_content",
                "displayValue": "View Content"
              },
              {
                "value": "view_category",
                "displayValue": "View Category"
              },
              {
                "value": "signup",
                "displayValue": "SignUp"
              },
              {
                "value": "watch_video",
                "displayValue": "Watch Video"
              }
            ],
            "simpleValueType": true,
            "defaultValue": "purchase",
            "displayName": "Event Name",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "alwaysInSummary": true
          }
        ]
      },
      {
        "value": "inherit",
        "subParams": [],
        "displayValue": "Inherit from client"
      },
      {
        "value": "custom",
        "subParams": [
          {
            "type": "TEXT",
            "name": "eventNameCustom",
            "displayName": "",
            "simpleValueType": true
          }
        ],
        "displayValue": "Custom"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "standard"
  },
  {
    "type": "SELECT",
    "name": "eventConversionType",
    "displayName": "Event Conversion Type",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "website",
        "displayValue": "Website"
      },
      {
        "value": "physical_store",
        "displayValue": "Physical Store"
      },
      {
        "value": "app",
        "displayValue": "Mobile App"
      }
    ],
    "simpleValueType": true,
    "defaultValue": "website",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "accessToken",
    "displayName": "Access Token",
    "simpleValueType": true,
    "help": "More info on how to get Access Token \u003ca target\u003d\"_blank\" href\u003d\"https://docs.developer.yelp.com/docs/conversions-api#data-access\"\u003ecan be found by this link\u003c/a\u003e.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "useOptimisticScenario",
    "checkboxText": "Use Optimistic Scenario",
    "simpleValueType": true,
    "help": "The tag will call gtmOnSuccess() without waiting for a response from the API. This will speed up sGTM response time however your tag will always return the status fired successfully even in case it is not."
  },
  {
    "type": "CHECKBOX",
    "name": "validate",
    "checkboxText": "Test Mode",
    "simpleValueType": true
  },
  {
    "displayName": "Server Parameters",
    "name": "serverDataListGroup",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "serverDataList",
        "displayName": "",
        "simpleTableColumns": [
          {
            "defaultValue": "event_id",
            "displayName": "Name",
            "name": "name",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "event_id",
                "displayValue": "Event ID"
              },
              {
                "value": "event_time",
                "displayValue": "Event Time"
              }
            ],
            "isUnique": true,
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT",
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ]
          }
        ],
        "newRowButtonText": "Add property"
      }
    ]
  },
  {
    "displayName": "User Data Parameters",
    "name": "userDataListGroup",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "type": "LABEL",
        "name": "userDataLabel",
        "displayName": "All parameters in this section will be automatically hashed if they are not hashed."
      },
      {
        "name": "userDataList",
        "simpleTableColumns": [
          {
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "defaultValue": "em",
            "displayName": "Property Name",
            "name": "name",
            "isUnique": true,
            "type": "SELECT",
            "selectItems": [
              {
                "value": "em",
                "displayValue": "Email"
              },
              {
                "value": "ph",
                "displayValue": "Phone Number"
              },
              {
                "value": "client_ip_address",
                "displayValue": "IP Address"
              },
              {
                "value": "madid",
                "displayValue": "MAID (IDFA or AAID)"
              },
              {
                "value": "fn",
                "displayValue": "First Name"
              },
              {
                "value": "ln",
                "displayValue": "Last Name"
              },
              {
                "value": "ct",
                "displayValue": "City"
              },
              {
                "value": "st",
                "displayValue": "State"
              },
              {
                "value": "zp",
                "displayValue": "Zip"
              },
              {
                "value": "country",
                "displayValue": "Country"
              },
              {
                "value": "external_id",
                "displayValue": "External ID"
              },
              {
                "value": "lead_id",
                "displayValue": "Lead ID"
              },
              {
                "value": "client_user_agent",
                "displayValue": "User Agent"
              },
              {
                "value": "db",
                "displayValue": "Birth Date"
              },
              {
                "value": "ge",
                "displayValue": "Gender"
              }
            ]
          },
          {
            "defaultValue": "",
            "displayName": "Property Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "type": "SIMPLE_TABLE",
        "newRowButtonText": "Add property"
      }
    ]
  },
  {
    "displayName": "Custom Data Parameters",
    "name": "customDataListGroup",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "type": "LABEL",
        "name": "сustomDataLabel",
        "displayName": "See \u003ca href\u003d\"https://docs.developer.yelp.com/docs/conversions-api#property-descriptions-and-requirements\" target\u003d\"_blank\"\u003ethis documentation\u003c/a\u003e for more details on what data parameters you can add to the call."
      },
      {
        "name": "customDataList",
        "simpleTableColumns": [
          {
            "valueValidators": [
              {
                "type": "NON_EMPTY"
              }
            ],
            "defaultValue": "",
            "displayName": "Property Name",
            "name": "name",
            "isUnique": true,
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Property Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "type": "SIMPLE_TABLE",
        "newRowButtonText": "Add property"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "consentSettingsGroup",
    "displayName": "Consent Settings",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "RADIO",
        "name": "adStorageConsent",
        "displayName": "",
        "radioItems": [
          {
            "value": "optional",
            "displayValue": "Send data always"
          },
          {
            "value": "required",
            "displayValue": "Send data in case marketing consent given"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "optional"
      }
    ]
  },
  {
    "displayName": "Logs Settings",
    "name": "logsGroup",
    "groupStyle": "ZIPPY_CLOSED",
    "type": "GROUP",
    "subParams": [
      {
        "type": "RADIO",
        "name": "logType",
        "radioItems": [
          {
            "value": "no",
            "displayValue": "Do not log"
          },
          {
            "value": "debug",
            "displayValue": "Log to console during debug and preview"
          },
          {
            "value": "always",
            "displayValue": "Always log to console"
          }
        ],
        "simpleValueType": true,
        "defaultValue": "debug"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const getAllEventData = require('getAllEventData');
const JSON = require('JSON');
const sendHttpRequest = require('sendHttpRequest');
const getTimestampMillis = require('getTimestampMillis');
const getContainerVersion = require('getContainerVersion');
const logToConsole = require('logToConsole');
const sha256Sync = require('sha256Sync');
const makeString = require('makeString');
const getRequestHeader = require('getRequestHeader');
const getType = require('getType');
const Math = require('Math');
const makeNumber = require('makeNumber');

const containerVersion = getContainerVersion();
const isDebug = containerVersion.debugMode;
const isLoggingEnabled = determinateIsLoggingEnabled();
const traceId = getRequestHeader('trace-id');

const eventData = getAllEventData();
const url = eventData.page_location || getRequestHeader('referer');

if (!isConsentGivenOrNotRequired()) {
  return data.gtmOnSuccess();
}

if (url && url.lastIndexOf('https://gtm-msr.appspot.com/', 0) === 0) {
  return data.gtmOnSuccess();
}

sendTrackRequest(mapEvent(eventData, data));

function sendTrackRequest(mappedEvent) {
  const postBody = mappedEvent;
  const postUrl = getPostUrl();

  if (isLoggingEnabled) {
    logToConsole(
      JSON.stringify({
        Name: 'Yelp',
        Type: 'Request',
        TraceId: traceId,
        EventName: mappedEvent.event_name,
        RequestMethod: 'POST',
        RequestUrl: postUrl,
        RequestBody: postBody
      })
    );
  }

  sendHttpRequest(
    postUrl,
    (statusCode, headers, body) => {
      if (isLoggingEnabled) {
        logToConsole(
          JSON.stringify({
            Name: 'Yelp',
            Type: 'Response',
            TraceId: traceId,
            EventName: mappedEvent.event_name,
            ResponseStatusCode: statusCode,
            ResponseHeaders: headers,
            ResponseBody: body
          })
        );
      }
      if (!data.useOptimisticScenario) {
        if (statusCode >= 200 && statusCode < 400) {
          data.gtmOnSuccess();
        } else {
          data.gtmOnFailure();
        }
      }
    },
    {
      headers: {
        'Authorization': 'Bearer '+ data.accessToken,
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },
      method: 'POST'
    },
    JSON.stringify(postBody)
  );
}

if (data.useOptimisticScenario) {
  data.gtmOnSuccess();
}

function getPostUrl() {
  return 'https://api.yelp.com/v3/conversion/event';
}

function getEventName(eventData, data) {
  if (data.eventType === 'inherit') {
    let eventName = eventData.event_name;

    let gaToEventName = {
      page_view: 'page_view',
      'gtm.dom': 'page_view',
      add_to_cart: 'add_to_cart',
      sign_up: 'signup',
      purchase: 'purchase',
      view_item: 'view_content',
      add_to_wishlist: 'add_to_wishlist',
      begin_checkout: 'checkout',
      add_payment_info: 'add_payment_info',
      view_item_list: 'view_content',
      search: 'search',
      generate_lead: 'signup',

      contact: 'lead',
      find_location: 'search',

      'gtm4wp.addProductToCartEEC': 'add_to_cart',
      'gtm4wp.productClickEEC': 'view_content',
      'gtm4wp.checkoutOptionEEC': 'START_CHECKOUT',
      'gtm4wp.checkoutStepEEC': 'checkout',
      'gtm4wp.orderCompletedEEC': 'purchase'
    };

    if (!gaToEventName[eventName]) {
      return eventName;
    }

    return gaToEventName[eventName];
  }

  return data.eventType === 'standard' ? data.eventNameStandard : data.eventNameCustom;
}

function mapEvent(eventData, data) {
  let mappedData = {
    user_data: {},
    custom_data: {}
  };

  mappedData = addServerData(eventData, mappedData);
  mappedData = addUserData(eventData, mappedData);
  mappedData = addCustomData(eventData, mappedData);
  mappedData = hashDataIfNeeded(mappedData);

  return mappedData;
}

function addCustomData(eventData, mappedData) {
  let currencyFromItems = '';
  let valueFromItems = 0;

  if (eventData.items && eventData.items[0]) {
    mappedData.custom_data.contents = [];
    currencyFromItems = eventData.items[0].currency;

    if (!eventData.items[1]) {
      if (eventData.items[0].id) mappedData.custom_data.content_ids = [eventData.items[0].item_id];

      if (eventData.items[0].price) {
        mappedData.custom_data.value = eventData.items[0].quantity
          ? eventData.items[0].quantity * eventData.items[0].price
          : eventData.items[0].price;
      }
    }

    const itemIdKey = data.itemIdKey ? data.itemIdKey : 'item_id';
    eventData.items.forEach((d, i) => {
      let content = {};
      if (d[itemIdKey]) content.id = d[itemIdKey];
      if (d.quantity) content.quantity = d.quantity;

      if (d.price) {
        content.item_price = makeNumber(d.price);
        valueFromItems += d.quantity ? d.quantity * content.item_price : content.item_price;
      }

      mappedData.custom_data.contents.push(content);
    });
  }

  if (eventData['x-ga-mp1-ev']) mappedData.custom_data.value = eventData['x-ga-mp1-ev'];
  else if (eventData['x-ga-mp1-tr']) mappedData.custom_data.value = eventData['x-ga-mp1-tr'];
  else if (eventData.value) mappedData.custom_data.value = eventData.value;

  if (eventData.currency) mappedData.custom_data.currency = eventData.currency;
  else if (currencyFromItems) mappedData.custom_data.currency = currencyFromItems;

  if (eventData.content_category) mappedData.custom_data.content_category = eventData.content_category;
  if (eventData.search_term) mappedData.custom_data.search_string = eventData.search_term;
  if (eventData.transaction_id) mappedData.custom_data.order_id = eventData.transaction_id;

  if (mappedData.event_name === 'purchase') {
    if (!mappedData.custom_data.currency) mappedData.custom_data.currency = 'USD';
    if (!mappedData.custom_data.value) mappedData.custom_data.value = valueFromItems ? valueFromItems : 0;
  }

  if (data.customDataList) {
    data.customDataList.forEach((d) => {
      if (isValidValue(d.value)) {
        mappedData.custom_data[d.name] = d.value;
      }
    });
  }

  return mappedData;
}

function addServerData(eventData, mappedData) {
  mappedData.event_name = getEventName(eventData, data);
  mappedData.event_time = Math.round(getTimestampMillis() / 1000);
  mappedData.action_source = data.eventConversionType;
  mappedData.test_event = data.validate;
  mappedData.integration = 'stape';

  const eventId = eventData.event_id || eventData.transaction_id;
  if (eventId) mappedData.event_id = eventId;

  if (data.serverDataList) {
    data.serverDataList.forEach((d) => {
      if (isValidValue(d.value)) {
        mappedData[d.name] = d.value;
      }
    });
  }

  return mappedData;
}

function isHashed(value) {
  if (!value) {
    return false;
  }

  return makeString(value).match('^[A-Fa-f0-9]{64}$') !== null;
}

function hashData(value) {
  if (!value) {
    return value;
  }

  const type = getType(value);

  if (type === 'undefined' || value === 'undefined') {
    return undefined;
  }

  if (type === 'object') {
    return value.map((val) => {
      return hashData(val);
    });
  }

  if (isHashed(value)) {
    return value;
  }

  return sha256Sync(makeString(value).trim().toLowerCase(), {
    outputEncoding: 'hex'
  });
}

function hashDataIfNeeded(mappedData) {
  const fieldsToHash = ['em', 'fn', 'ln', 'db', 'ge', 'ph', 'country', 'st', 'zp', 'ct', 'external_id'];
  const fieldsToArray = ['em', 'ph', 'country', 'st', 'zp', 'ct', 'external_id'];

  for (let key in mappedData.user_data) {
    if (fieldsToHash.indexOf(key) !== -1) {
      if (fieldsToArray.indexOf(key) !== -1 && (getType(mappedData.user_data[key]) !== 'object' || getType(mappedData.user_data[key]) !== 'array')) {
        mappedData.user_data[key] = [mappedData.user_data[key]];
      }

      mappedData.user_data[key] = hashData(mappedData.user_data[key]);
    }
  }
  return mappedData;
}

function addUserData(eventData, mappedData) {
  let user_data = eventData.user_data || {};
  let address = user_data.address || {};

  if (eventData.email) mappedData.user_data.em = eventData.email;
  else if (user_data.email_address) mappedData.user_data.em = user_data.email_address;
  else if (user_data.email) mappedData.user_data.em = user_data.email;

  if (eventData.lastName) mappedData.user_data.ln = eventData.lastName;
  else if (eventData.LastName) mappedData.user_data.ln = eventData.LastName;
  else if (eventData.nameLast) mappedData.user_data.ln = eventData.nameLast;
  else if (eventData.last_name) mappedData.user_data.ln = eventData.last_name;
  else if (user_data.last_name) mappedData.user_data.ln = user_data.last_name;
  else if (address.last_name) mappedData.user_data.ln = address.last_name;

  if (eventData.firstName) mappedData.user_data.fn = eventData.firstName;
  else if (eventData.FirstName) mappedData.user_data.fn = eventData.FirstName;
  else if (eventData.nameFirst) mappedData.user_data.fn = eventData.nameFirst;
  else if (eventData.first_name) mappedData.user_data.fn = eventData.first_name;
  else if (user_data.first_name) mappedData.user_data.fn = user_data.first_name;
  else if (address.first_name) mappedData.user_data.fn = address.first_name;

  if (eventData.date_of_birth) mappedData.user_data.db = eventData.date_of_birth;
  else if (eventData.db) mappedData.user_data.db = eventData.db;
  else if (user_data.db) mappedData.user_data.db = user_data.db;

  if (eventData.gender) mappedData.user_data.ge = eventData.gender;
  else if (eventData.ge) mappedData.user_data.ge = eventData.ge;
  else if (user_data.ge) mappedData.user_data.ge = user_data.ge;

  if (eventData.phone) mappedData.user_data.ph = eventData.phone;
  else if (user_data.phone_number) mappedData.user_data.ph = user_data.phone_number;

  if (eventData.countryCode) mappedData.user_data.country = eventData.countryCode;
  else if (eventData.country) mappedData.user_data.country = eventData.country;
  else if (user_data.country) mappedData.user_data.country = user_data.country;
  else if (address.country) mappedData.user_data.country = address.country;

  if (eventData.state) mappedData.user_data.st = eventData.state;
  else if (eventData.region) mappedData.user_data.st = eventData.region;
  else if (user_data.region) mappedData.user_data.st = user_data.region;
  else if (address.region) mappedData.user_data.st = address.region;

  if (eventData.zip) mappedData.user_data.zp = eventData.zip;
  else if (eventData.postal_code) mappedData.user_data.zp = eventData.postal_code;
  else if (user_data.postal_code) mappedData.user_data.zp = user_data.postal_code;
  else if (address.postal_code) mappedData.user_data.zp = address.postal_code;

  if (eventData.city) mappedData.user_data.ct = eventData.city;
  else if (address.city) mappedData.user_data.ct = address.city;

  if (eventData.external_id) mappedData.user_data.external_id = eventData.external_id;
  else if (eventData.user_id) mappedData.user_data.external_id = eventData.user_id;
  else if (eventData.userId) mappedData.user_data.external_id = eventData.userId;

  if (eventData.ip_override) {
    mappedData.user_data.client_ip_address = eventData.ip_override.split(' ').join('').split(',')[0];
  }

  if (eventData.lead_id) mappedData.user_data.lead_id = eventData.lead_id;
  else if (eventData.leadId) mappedData.user_data.lead_id = eventData.leadId;

  if (eventData.user_agent) mappedData.user_data.client_user_agent = eventData.user_agent;
  if (eventData.madid) mappedData.user_data.madid = eventData.madid;

  if (data.userDataList) {
    data.userDataList.forEach((d) => {
      if (isValidValue(d.value)) {
        mappedData.user_data[d.name] = d.value;
      }
    });
  }

  return mappedData;
}

function determinateIsLoggingEnabled() {
  if (!data.logType) {
    return isDebug;
  }

  if (data.logType === 'no') {
    return false;
  }

  if (data.logType === 'debug') {
    return isDebug;
  }

  return data.logType === 'always';
}

function isConsentGivenOrNotRequired() {
  if (data.adStorageConsent !== 'required') return true;
  if (eventData.consent_state) return !!eventData.consent_state.ad_storage;
  const xGaGcs = eventData['x-ga-gcs'] || ''; // x-ga-gcs is a string like "G110"
  return xGaGcs[2] === '1';
}

function isValidValue(value) {
  const valueType = getType(value);
  return valueType !== 'null' && valueType !== 'undefined' && value !== '';
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_request",
        "versionId": "1"
      },
      "param": [
        {
          "key": "headerWhitelist",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "trace-id"
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "headerName"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "referer"
                  }
                ]
              }
            ]
          }
        },
        {
          "key": "headersAllowed",
          "value": {
            "type": 8,
            "boolean": true
          }
        },
        {
          "key": "requestAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "headerAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "queryParameterAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_container_data",
        "versionId": "1"
      },
      "param": []
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://api.yelp.com/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 12/26/2024, 6:35:10 PM


